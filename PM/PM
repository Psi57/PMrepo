--check if http is enabled.
if not http then
    printError("Http is disabled,please set http_enable to true in ComputerCraft.cfg")
    return
end
--".information" preservation information of program that installed by PM
if not fs.isDir (".information") then
    fs.makeDir(".information")
    print("PS:.information is a important dir of PM,Don't delete or modify it.Thanks.")
end

local url = "https://raw.githubusercontent.com/wuxiangdong/PMrero/master/"
local index = {} --programs
local need = {}

local function init()
    local text
    --load index
    local response = http.get(url .. "index")
    if not response then 
        printError("Get index unsuccessfully")
        return false 
    end
    text = response.readLine()
    while text ~= EOF do
        index[text] = true
        text = response.readLine()
    end
    print("Get index successfully")
    response.close()
    print("Try input \"help\"")
    return true
end
    
    if not init() then
        printError("Init error")
        return
    end

local function install(name)
    if(index[name]) then 
        local response = http.get(url .. name .. "/need")
        local text = response.readLine()
        while text ~= EOF do 
            if not install (text) then
                printError("Install unsuccessfully.Dependency of " .. name .. "can't install.")
                return false
            end
            local r1 = http.get(url .. name .. "/version")
            local f1 =fs.open(".information/" .. text,"w")
            f1.write(r1.readAll() .. " dependency")
            f1.close()
            r1.close()
            text = response.readLine()
        end
        response.close()
        response = http.get(url .. name .. "/" .. name)
        local f = fs.open(name, "w")
        f.write(response.readAll())
        f.close()
        response.close()
        response = http.get(url .. name .. "/version")
        f =fs.open(".information/" .. text,"w")
        f.write(r1.readAll())
        f.close()
        response.close()        
        return true
        
    end
end
--Not finsh
